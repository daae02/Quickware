<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Quickware Distribution</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="" name="keywords">
  <meta content="" name="description">

  <!-- Favicons -->
  <link href="img/qw_icon.png" rel="icon">
  <link href="img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,700,900|Lato:400,900" rel="stylesheet">

  <!-- Bootstrap CSS File -->
  <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Libraries CSS Files -->
  <link href="lib/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="lib/prettyphoto/css/prettyphoto.css" rel="stylesheet">
  <link href="lib/hover/hoverex-all.css" rel="stylesheet">

  <!-- Main Stylesheet File -->
  <link href="css/style.css" rel="stylesheet">
  <script type="text/javascript" src="lib\sweetalert2-11.1.9\package\dist\sweetalert2.all.min.js" >  
  </script>
  <!-- =======================================================
    Template Name: Solid
    Template URL: https://templatemag.com/solid-bootstrap-business-template/
    Author: TemplateMag.com
    License: https://templatemag.com/license/
  ======================================================= -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>


  <!-- Fixed navbar -->
  <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        <a class="navbar-brand" href="blog.html">Quickware Distribution</a>
      </div>
      <div class="navbar-collapse collapse navbar-right">
        <ul class="nav navbar-nav">
          <li id="bye2"><a href="index.html">PEDIDOS</a></li>
          <li id="bye3"><a href="about.html">PRODUCTOS</a></li>

          <li id="bye" style="display:none" class="dropdown"> 
            <a id="name_user" href="#" class="dropdown-toggle" data-toggle="dropdown"> 
              <i class="fa fa-user fa-fw"></i> Leo <b class="caret"></b></a>
            <ul class="dropdown-menu">     
              <li onclick="return cerrar_ses();">
                <a href="blog.html"><i class="fa fa-sign-out fa-fw"></i> ʕ•́ᴥ•̀ʔっ</a>
              </li>
            </ul>
          </li>  

          <li id="opcion" class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">OPCIONES <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a id="iniciar_ses" href="blog.html">INICIAR SESIÓN</a></li>
              <li><a id="regist" href="single-post.html">REGISTRARSE</a></li>
            </ul>
          </li>
        </ul>
      </div>
      <!--/.nav-collapse -->
    </div>
  </div>
  <!-- *****************************************************************************************************************
	 BLUE WRAP
	 ***************************************************************************************************************** -->
  <div id="blue">
    <div class="container">
      <div class="row">
        <h3 id ="titulo_ped" class="text-center">PEDIDOS</h3>
      </div>
      <!-- /row -->
    </div>
    <!-- /container -->
  </div>

  <div class="row">
    <div class="col-ls-5 col-ls-5">
      <div class="text-center">
        <div class="card">
            <div class="card-content"> 
              <ul class="collapsible" data-collapsible="accordion">
                
              <template id="productos_ord"> 
                <li class=""> 
                  <div class="collapsible-header">
                      <h3><i class="material-icons dp48">lock_open</i>First</h3>
                  </div>
                  <div class="collapsible-body">
                    
                    <template>
                      <div class="row">
                        <div class="col-lg-3 col-ms-3">
                          <img src="" alt="" width="50" height="50">
                        </div>                        
                        <div class="col-lg-3 col-ms-3">
                          <p></p>
                        </div>                        
                        <div class="col-lg-3 col-ms-3">
                          <p>C/U <i></i>$ X <i></i></p>
                        </div>                        
                        <div class="col-lg-3 col-ms-3">
                          <p><i></i>$</p>
                        </div>
                      </div>
                    </template>     
                  <template>  
                    <div class="row">
                      <div class="col-lg-3 col-ms-3">
                        <button type="button" class="btn btn-success">Guardar Cambios</button>
                      </div>
                      
                      <div class="col-lg-3 col-ms-3">
                        <div>                                        
                          <button type="button" class="btn btn-danger">Eliminar Pedido</button>
                        </div>
                      </div>
                      
                      <div class="col-lg-3 col-ms-3">
                        <p></p>
                      </div>
                      
                      <div class="col-lg-3 col-ms-3">
                        <p>Precio total pedido</p>
                      </div>
                    </div> 
                  </template>                              
                  </div>
                </li>                
              </template> 
              </ul> 
                
            </div>
          </div>
        </div>              
    </div>
</div>

  <div style="height:60px;">
  </div>
  <!-- *****************************************************************************************************************
	 FOOTER
	 ***************************************************************************************************************** -->
   <div id="footerwrap">
    <div class="container">
      <div class="row">
        <div class="col-lg-4">
          <h4>Quickware Distribution</h4>
          <div class="hline-w"></div>
          <p>Somos una de los principales distribuidores en el area de insumos sobre ferreterias. Tenemos la última tecnología.</p>
        </div>
        <div class="col-lg-4">
          <h4>Redes Sociales</h4>
          <div class="hline-w"></div>
          <p>
            <a href="#"><i class="fa fa-dribbble"></i></a>
            <a href="#"><i class="fa fa-facebook"></i></a>
            <a href="#"><i class="fa fa-twitter"></i></a>
            <a href="#"><i class="fa fa-instagram"></i></a>
            <a href="#"><i class="fa fa-tumblr"></i></a>
          </p>
        </div>
        <div class="col-lg-4">
          <h4>Nuestra dirección</h4>
          <div class="hline-w"></div>
          <p>
            Calle 15, Avenida 14., <br/>1 km Sur de la Basílica de los Ángeles., <br/>Provincia de Cartago, Cartago, 30101
          </p>
        </div>

      </div>
    </div>
  </div>

  <div id="copyrights">
    <div class="container">
      <p>
        &copy; Copyrights <strong>Quickware Distribution</strong>. All Rights Reserved
      </p>
    </div>
  </div>

    <!-- JavaScript Libraries -->
    <script src="lib/jquery/jquery.min.js"></script>
    <script src="lib/bootstrap/js/bootstrap.min.js"></script>
    <script src="lib/php-mail-form/validate.js"></script>
    <script src="lib/prettyphoto/js/prettyphoto.js"></script>
    <script src="lib/isotope/isotope.min.js"></script>
    <script src="lib/hover/hoverdir.js"></script>
    <script src="lib/hover/hoverex.min.js"></script>
  
    <!-- Template Main Javascript File -->
    <script src="js/main.js"></script> 

	  <script src="assets/materialize/js/materialize.min.js"></script>

<script type="text/javascript">

  function agregar_ped(card,ord_n){
    var plantilla = document.getElementById('productos_ord');
    clone = plantilla.content.cloneNode(true);

    fields = clone.querySelectorAll('template');
    fields[0].id = "productos_ord_"+ord_n;
    fields[1].id = "productos_boton_"+ord_n;

    fields = clone.querySelectorAll('h3');
    if (card.StatusId < 3 || card.StatusId == 7){
      fields[0].innerHTML = '<i class="material-icons dp48">lock_open</i> #'+ord_n+' '+card.CreationDate.slice(0, 10);
    }
    else if (card.StatusId == 3 || card.StatusId ==  5){
      fields[0].innerHTML = '<i class="material-icons dp48">lock_outline</i> #'+ord_n+' '+card.CreationDate.slice(0, 10);
    }else{
      fields[0].innerHTML = '<i class="material-icons dp48">done_all</i> #'+ord_n+' '+card.CreationDate.slice(0, 10);
    }  

    fields = clone.querySelectorAll('li');
    fields[0].class = "";
    fields = clone.querySelectorAll('div');
    fields[1].style.display = "none";

    plantilla.parentNode.appendChild(clone);
    return;
  }  
  function agregar_prod(card,ord_n){
    var plantilla = document.getElementById("productos_ord_"+ord_n);
    clone = plantilla.content.cloneNode(true);

    fields = clone.querySelectorAll('img');
    fields[0].src = card.PictureURL;

    fields = clone.querySelectorAll('p');
    fields[0].textContent = card.Title;

    fields = clone.querySelectorAll('i');
    fields[0].textContent = card.UnityPrice ;
    fields[1].textContent = card.Quantity ;
    fields[1].id = ord_n +" " + card.ProductId ;    
    fields[2].textContent = (parseInt(card.UnityPrice)*parseInt(card.Quantity));
    fields[2].id = ord_n +" " + card.ProductId + "2";
    
    plantilla.parentNode.appendChild(clone);
    return;
  }
  function agregar_boton(pre_tot,ord_n,estatus){
    var plantilla = document.getElementById("productos_boton_"+ord_n);
    clone = plantilla.content.cloneNode(true);
    if(parseInt(estatus) > 1){
      fields = clone.querySelectorAll('div');
      fields[1].innerHTML = "<span></span>";
      fields[2].innerHTML = "<span></span>";
    }
    fields = clone.querySelectorAll('p');
    fields[1].textContent = 'Total: '+pre_tot+'$';
    
    plantilla.parentNode.appendChild(clone);
    return;
  }  

  function ver_id_prod(ids_pro_orden, card,ord_n){ 
      let tama = ids_pro_orden.length;
      let index = 0;
      let aux = 0;
      while(index < tama){
        if(ids_pro_orden[index] == card.ProductId){
          var elemento = document.getElementById(ord_n +" " + card.ProductId);
          aux = parseInt(elemento.textContent) + parseInt(card.Quantity);
          elemento.textContent = aux ;

          elemento = document.getElementById(ord_n +" " + card.ProductId + "2");
          elemento.textContent = aux * parseInt(card.UnityPrice);

          return false;
        }
        index += 1;
      }
      return true;
    }
    
  // cards
  $.getJSON(`http://localhost:3000/ordenes/${localStorage.store_email}`, function(data) {    
          let ids_pro_orden = []; 
          var cards = data;
          let ord_n = 1;
          let num_ord = -1;
          let num_ord_ant = -1;
          let pre_tot = 0;          
          let estatus = 0;
          $.each(cards, function(index, card) {
              console.log(estatus);              
              num_ord = card.OrderId;
              if(num_ord_ant == -1){
                num_ord_ant = num_ord;
                agregar_ped(card,ord_n);
              }
              if(num_ord == num_ord_ant){
                if(ver_id_prod(ids_pro_orden, card,ord_n)){
                  agregar_prod(card,ord_n);
                  ids_pro_orden.push(card.ProductId);                  
                  estatus = card.StatusId;
                }
                pre_tot += (parseInt(card.UnityPrice)*parseInt(card.Quantity));
              }else{  
                
                agregar_boton(pre_tot,ord_n,estatus);  
                
                ord_n += 1;
                ids_pro_orden = [];  
                pre_tot = 0;       
                agregar_ped(card,ord_n);                                
                agregar_prod(card,ord_n);                
                pre_tot += (parseInt(card.UnityPrice)*parseInt(card.Quantity));
                num_ord_ant = num_ord;                               
                estatus = card.StatusId;
              }
          });
          agregar_boton(pre_tot,ord_n,estatus); 
      });
 
  </script>


<script type="text/javascript">  
  if(localStorage.store_email != ""){
    document.getElementById("opcion").style.display = "none";  
    document.getElementById("bye").style.display = "block";  
    document.getElementById("bye2").style.display = "block"; 
    document.getElementById("bye3").style.display = "block"; 
    document.getElementById("name_user").innerHTML = '<i class="fa fa-user fa-fw"></i>'+localStorage.store_email+'<b class="caret"></b>'; 
  }else{          
    document.getElementById("opcion").style.display = "block";          
    document.getElementById("bye").style.display = "none"; 
    document.getElementById("bye2").style.display = "none"; 
    document.getElementById("bye3").style.display = "none"; 
    document.getElementById("name_user").textContent = ""; 
  }
  function cerrar_ses(){
    localStorage.store_email = "";
    return;
  }
</script>
</body>
</html>
